 <% category_posts.each do |data| %>
  <% category = data[:category] %>
  <% posts = data[:posts] %>
    <div i d="sec">
  <div id="category_posts_<%= category.id %>" class="category_posts">
    <h1><%= category.name %></h1>
  <ul>
    <% posts.each do |post| %>
    <li>
      <p><%= link_to post.title, post_path(post.id) %></p>
      <p><%= post.text %></p>
      <% if post.images.attached? %>
        <% post.images.each do |image| %>
          <%= image_tag image %>
        <% end %>
      <% end %>
      <p><%= post.user.name %></p>
      <p><%= link_to "#{post.post_comments.count} コメント", post_path(post.id) %></p>
  </li>
    <% end %>
  </ul>
  </div>
</div>
<% end %>

<script> 
  var search = '<%= search %>'
  var category_id = '<%= category_id %>'
  $('#tab_wrapper input').on('click', (e) => {
    const target_id = e.target.id.replace('tab_category_', '')

    console.log("検索したキーワード：", search)
    console.log("検索したときのタブのカテゴリーID：", category_id)
    console.log("今選んだカテゴリーID：", target_id)
   
    $('#category_id').val(target_id)
    if (target_id === '0') {
       $('.category_posts').show()
    } else {
      $('.category_posts').hide()
      $(`#category_posts_${target_id}`).show()
    }
    if (category_id == target_id) {
      $('#search').val(search)
    } else {
      $('#search').val("")
    }
  })
</script>